var g_sdsharemode='';var g_samba_info='';var g_dhcpData;var folder_path = {    CurrentPath: ''};var g_samba_path='';var FILE_LIST_TYPE_FOLDER ='0';
var chooseContent = "<div id='file_path_wrapper' class='file_path_wrapper'><p>" + sd_hint_select_a_folder + "</p><div id='file_tree_wrapper' class='file_tree_wrapper'><div id='file_tree_div' class='file_tree_div'></div></div></div>";/** * DLNA的使能状态和共享文件图标
 */function updateDlnaRadioStatus() {    if ($("[name='dlna_status']:checked").val() == 0) {        $('#dlna_mode_table tr:eq(0)').hide();        $('#userpath_select_dlna').hide();        $('#userpath_note_dlna').hide();        $('#allpath_note_dlna').hide();	$("#file_path").children().html(XSSResolveCannotParseChar(g_samba_path));     }else{        $('#dlna_mode_table tr:eq(0)').show();         if($('#usermanege_path_dlna').val()== '0'){            $('#userpath_select_dlna').show();            $('#userpath_note_dlna').show();            $('#allpath_note_dlna').hide();            $("#file_path").children().html(XSSResolveCannotParseChar(g_samba_path));              }else{            $('#userpath_select_dlna').hide();            $('#userpath_note_dlna').hide();            $('#allpath_note_dlna').show();           }         }}/** * 获得共享的数据设置clear按钮和数据的关系 ，没有共享的数据按钮不使能
 */function initPage() {       getAjaxData('api/sdcard/sdcard', function($xml) {        var ret = xml2object($xml);        g_sdsharemode = ret.response.sdcard.SDShareMode;     },{sync : true});    getAjaxData("api/sdcard/dlna-setting", function($xml) {        var samba_info = xml2object($xml);        if("response" == samba_info.type) {            g_samba_info = samba_info.response;            g_samba_path = g_samba_info.sharepath;            $("input[name='dlna_status'][value=" + g_samba_info.enabled + ']').attr('checked', true);            $('#usermanege_path_dlna').val(g_samba_info.shareallpath);            $("#file_path").html("<pre>"+XSSResolveCannotParseChar(g_samba_path)+"</pre>");            updateDlnaRadioStatus();        } else {            showInfoDialog(common_error);            return false;        }    }, {        sync: true    });  }function apply() {    if (!isButtonEnable('apply_button')) {        return;    }    g_samba_info.enabled  = $("[name='dlna_status']:checked").val();    g_samba_info.shareallpath = $('#usermanege_path_dlna').val();    g_samba_info.sharepath = $("#file_path").children().html();    var xmlstr=object2xml('request', g_samba_info);    button_enable('apply_button', '0');    saveAjaxData('api/sdcard/dlna-setting', xmlstr, function($xml){        var ret = xml2object($xml);        if ("response" == ret.type && "OK" == ret.response) {            showInfoDialog(common_success);            button_enable("apply_button", "0");            setTimeout(function() {gotoPageWithHistory('dlna.html');}, 2500);        } else {            showInfoDialog(common_failed);            setTimeout(function() {gotoPageWithHistory('dlna.html');}, 2500);        }    }, {        sync: true    });}/** * 共享文件的方法
 */function displayCustomerTree(parent_id ,root_path) {    var current_path = root_path;    var filter_path = '';    var newList = '<ul>';    if ('/' == current_path)    {        filter_path = '/';    }    else    {        filter_path = '/' + current_path.replace(/\*/g, '/');    }    folder_path.CurrentPath = filter_path;    var send_xml = object2xml('request', folder_path);    saveAjaxData('api/sdcard/sdfile', send_xml, function($xml) {        var return_ret = xml2object($xml);        if('/' == root_path) {           $('#' + parent_id).empty();        }        if ('response' == return_ret.type)        {            var folder_lists = return_ret.response.FileList.File;            if ($.isArray(folder_lists))            {                var folder_count = 0;                var folder_list_count = 0;                $.each(folder_lists, function(i) {                    if (FILE_LIST_TYPE_FOLDER == folder_lists[i].Type)                    {                        folder_count++;                    }                });                $.each(folder_lists, function(i) {                    if (FILE_LIST_TYPE_FOLDER == folder_lists[i].Type)                    {                        var folder_parent_id = '';                        var folder_parent_path = '';                        var folder_name = '';                        if ('/' == root_path)                        {                            folder_name = sd_resolveEntityReference(folder_lists[i].Name);                            folder_parent_id = parent_id + i;                            folder_parent_path = folder_name;                        }                        else                        {                            folder_name = sd_resolveEntityReference(folder_lists[i].Name);                            folder_parent_id = parent_id + i;                            folder_parent_path = current_path + '\*' + folder_name;                        }                        folder_parent_path = folder_parent_path.replace(/\'/g, '&#39;');                        if ((folder_count - 1) > folder_list_count)                        {                            newList += "<li id='" + folder_parent_id + "' class='sub_folder_li expandable'><div id='list_flag\*" + folder_parent_id + "' class='hitarea expandable-hitarea'></div><span  id='folder_" + folder_parent_path + "' class='folder_path_line'><a class='folder_name' href='javascript: void(0)' title="+folder_name+"><pre>" + folder_name + '</pre></a></span></li>';                        }                        else                        {                            newList += "<li id='" + folder_parent_id + "' class='sub_folder_li expandable lastExpandable'><div id='list_flag\*" + folder_parent_id + "' class='hitarea expandable-hitarea lastExpandable-hitarea'></div><span id='folder_" + folder_parent_path + "' class='folder_path_line'><a class='folder_name' href='javascript: void(0)' title="+ folder_name + "><pre>" + folder_name + '</pre></a></span></li>';                        }                        folder_list_count++;                    }                });                if ('<ul>' == newList)                {                    if ($('#' + parent_id).children('div').hasClass('lastExpandable-hitarea'))                    {                        $('#' + parent_id).children('div').removeClass('hitarea').removeClass('lastExpandable-hitarea').removeClass('collapsable-hitarea').addClass('noSubFolder_last');                        $('#' + parent_id).children('span.folder_path_line').css({'background': 'none'});                    }                    else                    {                        $('#' + parent_id).removeClass('expandable').removeClass('collapsable').children('div').removeClass('hitarea').removeClass('expandable-hitarea').removeClass('collapsable-hitarea').addClass('noSubFolder');                        $('#' + parent_id).children('span.folder_path_line').css({'background': 'none'});                    }                }                else                {                    $('#' + parent_id).append(newList);                }            }            else if (typeof(folder_lists) != 'undefined')            {                if (FILE_LIST_TYPE_FOLDER == folder_lists.Type)                {                    var folder_parent_id = '';                    var folder_parent_path = '';                    var folder_name = '';                    if ('/' == root_path)                    {                        folder_name = sd_resolveEntityReference(folder_lists.Name);                        folder_parent_id = parent_id + '0';                        folder_parent_path = folder_name;                    }                    else                    {                        folder_name = sd_resolveEntityReference(folder_lists.Name);                        folder_parent_id = parent_id + '0';                        folder_parent_path = current_path + '\*' + folder_name;                    }                    folder_parent_path = folder_parent_path.replace(/\'/g, '&#39;');                    newList += "<li id='" + folder_parent_id + "' class='sub_folder_li expandable lastExpandable'><div id='list_flag\*" + folder_parent_id + "' class='hitarea expandable-hitarea lastExpandable-hitarea'></div><span id='folder_" + folder_parent_path + "' class='folder_path_line'><a class='folder_name' href='javascript: void(0)'title="+folder_name+"><pre>" + folder_name + '</pre></a></span></li>';                    $('#' + parent_id).append(newList);                }                else                {                    if ($('#' + parent_id).children('div').hasClass('lastExpandable-hitarea'))                    {                        $('#' + parent_id).children('div').removeClass('hitarea').removeClass('lastExpandable-hitarea').removeClass('collapsable-hitarea').addClass('noSubFolder_last');                        $('#' + parent_id).children('span.folder_path_line').css({'background': 'none'});                    }                    else                    {                        $('#' + parent_id).removeClass('expandable').removeClass('collapsable').children('div').removeClass('hitarea').removeClass('expandable-hitarea').removeClass('collapsable-hitarea').addClass('noSubFolder');                        $('#' + parent_id).children('span.folder_path_line').css({'background': 'none'});                    }                }            }            else            {                if ($('#' + parent_id).children('div').hasClass('lastExpandable-hitarea'))                {                    $('#' + parent_id).children('div').removeClass().addClass('noSubFolder_last');                    $('#' + parent_id).children('span.folder_path_line').css({'background': 'none'});                }                else                {                    $('#' + parent_id).removeClass('expandable').removeClass('collapsable').children('div').removeClass().addClass('noSubFolder');                    $('#' + parent_id).children('span.folder_path_line').css({'background': 'none'});                }            }        }    },    {        timeout:3000000    });}function createSubFolderTree(obj_id) {   if ($('#' + obj_id).hasClass('lastExpandable'))   {       $('#' + obj_id).addClass('collapsable');       $('#' + obj_id).removeClass('expandable');       $('#' + obj_id).addClass('lastCollapsable');       $('#' + obj_id).removeClass('lastExpandable');       $('#' + obj_id).children('div').addClass('collapsable-hitarea');       $('#' + obj_id).children('div').removeClass('expandable-hitarea');       $('#' + obj_id).addClass('loaded_sublist');   }   else   {       $('#' + obj_id).addClass('collapsable');       $('#' + obj_id).removeClass('expandable');       $('#' + obj_id).children('div').addClass('collapsable-hitarea');       $('#' + obj_id).children('div').removeClass('expandable-hitarea');       $('#' + obj_id).addClass('loaded_sublist');   }}function showSubFolderTree(obj_id) {    if ($('#' + obj_id).hasClass('lastExpandable'))    {        $('#' + obj_id).addClass('collapsable');        $('#' + obj_id).removeClass('expandable');        $('#' + obj_id).addClass('lastCollapsable');        $('#' + obj_id).removeClass('lastExpandable');        $('#' + obj_id).children('div').addClass('collapsable-hitarea');        $('#' + obj_id).children('div').removeClass('expandable-hitarea');        $('#' + obj_id).children('ul').css({'display': 'block'});    }    else    {        $('#' + obj_id).addClass('collapsable');        $('#' + obj_id).removeClass('expandable');         $('#' + obj_id).children('div').addClass('collapsable-hitarea');        $('#' + obj_id).children('div').removeClass('expandable-hitarea');        $('#' + obj_id).children('ul').css({'display': 'block'});    }}function hideSubFolderTree(obj_id) {    if ($('#' + obj_id).hasClass('lastCollapsable'))    {        $('#' + obj_id).addClass('expandable');        $('#' + obj_id).removeClass('collapsable');        $('#' + obj_id).addClass('lastExpandable');        $('#' + obj_id).removeClass('lastCollapsable');        $('#' + obj_id).children('div').addClass('expandable-hitarea');        $('#' + obj_id).children('div').removeClass('collapsable-hitarea');        $('#' + obj_id).children('ul').css({'display': 'none'});    }    else    {        $('#' + obj_id).addClass('expandable');        $('#' + obj_id).removeClass('collapsable');        $('#' + obj_id).children('div').addClass('expandable-hitarea');        $('#' + obj_id).children('div').removeClass('collapsable-hitarea');        $('#' + obj_id).children('ul').css({'display': 'none'});    }}$(document).ready( function() {           $('input').bind('change input paste cut keydown', function() {        button_enable('apply_button', '1');    });    //共享文件夹的点击事件    $("#custom_path").live("click", function() {        if(!isButtonEnable("custom_path")) {            return;        }        $('.dialog_close_btn').die('click');        call_dialog(sd_hint_select_a_folder, chooseContent, common_ok, "samba_path_dialog_ok", common_cancel, "path_dialog_cancel");        displayCustomerTree("file_tree_div", "/");        button_enable("samba_path_dialog_ok", "0");        button_enable("add_share_path_finish", "1");        button_enable('apply_button', '1');            });    //OK的单击事件    $('#samba_path_dialog_ok').live('click', function() {        if (!isButtonEnable('samba_path_dialog_ok')) {            return;        }        var folder_path = $('a.focusfolder').closest('span').attr('id');        if (typeof(folder_path) != 'undefined')        {            folder_path = folder_path.substring(folder_path.indexOf('_') + 1);            folder_path = folder_path.replace(/\*/g, '/');            folder_path = '/' + folder_path;            $('.dialog, .info_dialog').fadeOut(function() {                if ($('.info_dialog').size() == 0) {                    $('#div_wrapper').hide();                }            });            $('#file_path').html('<pre>' + XSSResolveCannotParseChar(folder_path) + '</pre>');            $('#wait_table').remove();            if ($('.info_dialog').size() == 0) {                $('#div_wrapper').hide();            }        }        else        {            $('.dialog, .info_dialog').fadeOut(function() {                if ($('.info_dialog').size() == 0) {                    $('#div_wrapper').hide();                }            });        }    });    //Folder of folder tree clicked    $('.sub_folder_li').live('click', function() {        button_enable('samba_path_dialog_ok', '1');    });        //Folder tree list click    $('div.hitarea').live('click', function() {        var list_id = $(this).closest('li').attr('id');        var list_path = $(this).next().attr('id');        list_path = list_path.substring(list_path.indexOf('_') + 1);        list_path = list_path.replace(/\&/g, '&amp;');        //list_id = list_id_filter;        if ($('#' + list_id).hasClass('expandable') && !$('#' + list_id).hasClass('loaded_sublist'))        {            displayCustomerTree(list_id, list_path);            createSubFolderTree(list_id);            if ($('#' + list_id).children('div').hasClass('noSubFolder'))            {                $('#' + list_id).children('span.folder_path_line').css({'background': 'none'});            }            else            {	               if(('ar_sa' == $('#lang').val()) || ('he_il' == $('#lang').val()) || ('fa_fa' == $('#lang').val())){                  $('#' + list_id).children('span.folder_path_line').css({'background': 'url(../res/treeview-default-line-a.gif) right 0 repeat-y'});               }else{                  $('#' + list_id).children('span.folder_path_line').css({'background': 'url(../res/treeview-default-line.gif) 0 0 repeat-y'});               }            }        }        else if ($('#' + list_id).hasClass('expandable') && $('#' + list_id).hasClass('loaded_sublist'))        {            showSubFolderTree(list_id);            if(('ar_sa' == $('#lang').val()) || ('he_il' == $('#lang').val()) || ('fa_fa' == $('#lang').val())){               $('#' + list_id).children('span.folder_path_line').css({'background': 'url(../res/treeview-default-line-a.gif) right 0 repeat-y'});	            }else{               $('#' + list_id).children('span.folder_path_line').css({'background': 'url(../res/treeview-default-line.gif) 0 0 repeat-y'});	            }                 }        else        {            hideSubFolderTree(list_id);            $('#' + list_id).children('span.folder_path_line').css({'background': 'none'});        }    });    //Mouseover folder tree    $('a.folder_name').live('mouseover', function() {        $(this).addClass('folder_hover');    });    $('a.folder_name').live('mouseout', function() {        $(this).removeClass('folder_hover');    });    //Mouse click folder tree    $('a.folder_name').live('click', function() {        if ($(this).hasClass('focusfolder') == false) {            $('a.focusfolder').removeClass('focusfolder');            $(this).addClass('focusfolder');        }    });    //Confirm folder which is customer folder path    $('#samba_path_dialog_ok').live('click', function() {        if (!isButtonEnable('samba_path_dialog_ok')) {            return;        }        var folder_path = $('a.focusfolder').closest('span').attr('id');        if (typeof(folder_path) != 'undefined')        {            folder_path = folder_path.substring(folder_path.indexOf('_') + 1);            folder_path = folder_path.replace(/\*/g, '/');            folder_path = '/' + folder_path;            $('.dialog, .info_dialog').fadeOut(function() {                if ($('.info_dialog').size() == 0) {                    $('#div_wrapper').hide();                }            });            $('#file_path').html('<pre>' + XSSResolveCannotParseChar(folder_path) + '</pre>');            $('#wait_table').remove();            if ($('.info_dialog').size() == 0) {                $('#div_wrapper').hide();            }        }        else        {            $('.dialog, .info_dialog').fadeOut(function() {                if ($('.info_dialog').size() == 0) {                    $('#div_wrapper').hide();                }            });        }    });    // 取消按钮的点击事件    $('#path_dialog_cancel').live('click', function() {        $('.dialog, .info_dialog').fadeOut( function() {            if ($('.info_dialog').size() == 0) {                $('#div_wrapper').hide();            }        });    });    //dlna状态的 点击事件    $("[name='dlna_status']").click( function() {        updateDlnaRadioStatus();    });    $("#apply_button").click( function() {        if(!isButtonEnable("apply_button")){            return;            }        apply();    });    button_enable('apply_button', '0');    initPage();    $("#usermanege_path_dlna").change( function() {        button_enable('apply_button', '1');        if($('#usermanege_path_dlna').val()=='1'){            $('#userpath_select_dlna').hide();            $('#userpath_note_dlna').hide();            $('#allpath_note_dlna').show();              $("#file_path").children().html('/');          }        if($('#usermanege_path_dlna').val()=='0'){            $('#userpath_select_dlna').show();            $('#userpath_note_dlna').show();            $('#allpath_note_dlna').hide();            $("#file_path").children().html(XSSResolveCannotParseChar(g_samba_path));              button_enable('custom_path', '1');              }    });    if(g_sdsharemode == 1){        $("#custom_path").die();        $("[name='dlna_status']").attr('disabled','disabled');        $('#usermanege_path_dlna').attr('disabled','disabled');        $("#apply_button").die();        button_enable('custom_path', '0');        button_enable('apply_button', '0');         showInfoDialog(IDS_dlna_server_ennabled);               }  });